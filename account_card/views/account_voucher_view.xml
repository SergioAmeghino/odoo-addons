<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!--  Vouchers -->
    <record model="ir.ui.view" id="view_account_voucher_tree">
        <field name="name">account.voucher.tree</field>
        <field name="model">account.voucher</field>
        <field name="priority">100</field>
        <field name="groups_id" eval="[(4, ref('account.group_account_manager'))]"/>
        <field name="arch" type="xml">
            <tree create="false" string="Vouchers">
                <field name="voucherbook_id" invisible="context.get('default_type',False) != 'issue_voucher'"/>
                <field name="journal_id" invisible="1"/>
                <field name="name" string="Nombre"/>
                <field name="issue_date" string="Fecha de Emisión"/>
                <field name="payment_date" string="Fecha de Pago"/>
                <field name="first_partner_id"/>
                <field name="partner_id" string="Contacto"/>
                <field name="type" invisible="1" string="Tipo"/>
                <field name="card_id" invisible="context.get('default_type',False) != 'third_voucher'" string="Banco"/>
                <field name="amount" sum="Total Amount" string="Monto"/>
                <field name="company_id" groups="base.group_multi_company" string="Compañía"/>
                <field name="state" string="Estado"/>
                <field name="owner_name" invisible="context.get('default_type',False) != 'third_voucher'" string="Nombre del Propietario"/>
                <field name="currency_id" invisible="1" string="Moneda"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_account_voucher_create_tree">
        <field name="name">account.voucher.create.tree</field>
        <field name="model">account.voucher</field>
        <field name="groups_id" eval="[(4, ref('account.group_account_manager'))]"/>
        <field name="inherit_id" ref="view_account_voucher_tree"/>
        <field name="arch" type="xml">
                <tree position="attributes">
                <attribute name="create">true</attribute>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_account_voucher_form">
        <field name="name">account.voucher.form</field>
        <field name="model">account.voucher</field>
        <field name="arch" type="xml">
            <form string="Vouchers" create="false">
                <field name="id" invisible="1"/>
                <field name="type" invisible="1"/>
                <field name="journal_id" invisible="1"/>
                <field name="issue_voucher_subtype" invisible="1"/>
                <field name="company_currency_id" invisible="1"/>
            <header>
                <button context="{'default_action_type': 'bank_deposit'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Depositar" states="holding" help="Creará una entrada de diario de la cuenta de vouchers diferida a la cuenta bancaria y cambiará el estado del voucher."/>
                <button context="{'default_action_type': 'reject'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Retorno de Proveedor/Rechazo" states="handed" help="Creará un borrador de nota de débito del proveedor y cambiará el estado del voucher."/>
                <button context="{'default_action_type': 'claim'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Reclamar a Cliente" attrs="{'invisible': ['|', ('state', '!=', 'rejected'), ('type', '!=', 'third_voucher')]}" help="Creará un borrador de nota de débito para el cliente y cambiará el estado del voucher."/>
                <button context="{'default_action_type': 'customer_return'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Devolver a Cliente" attrs="{'invisible': ['|', ('state', '!=', 'holding'), ('type', '!=', 'third_voucher')]}" help="Creará un borrador de nota de débito para el cliente y cambiará el estado del voucher ."/>
                <button context="{'default_action_type': 'bank_debit'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Debitar" states="handed" help="Creará una entrada de diario de la cuenta de vouchers diferida a la cuenta bancaria y cambiará el estado del voucher."/>
                !--button context="{'default_action_type': 'reject'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Retorno de Proveedor/Rechazo" states="handed" help="It will create a draft debit note from supplier and change voucher state"/-->
                <button context="{'default_action_type': 'reject'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Rechazo del Proveedor" states="delivered" help="Creará una nota de débito del proveedor en estado de borrador y cambiará el estado del voucher."/>
                <button context="{'default_action_type': 'reject'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Rechazo Bancario" states="deposited" help="Creará una entrada de cuenta desde la cuenta bancaria a la cuenta de rechazo de la empresa y cambiará el estado del voucher."/>
                <button context="{'default_action_type': 'reject'}" name="%(action_account_voucher_action_wizard)d" type="action" string="Rechazo de la Venta" states="selled" help="Creará una entrada de cuenta desde la cuenta de efectivo a la cuenta de rechazo de la empresa y cambiará el estado del voucher."/>
            </header>
            <sheet string="Vouchers">
                <h1>
                    <field name="name" string="Nombre"/>
                </h1>
                <group>
                    <group>
                        <field name="journal_id" string="Diario"/>
                        <field name="voucherbook_id" attrs="{'invisible':[('type','!=','issue_voucher')],'required':[('type','=','issue_voucher')]}" domain="[('journal_id', '=', journal_id)]"/>
                        <field name="card_id" string="Banco"/>
                        <field name="number" string="Número"/>
                        <label for="amount"/>
                        <div name="amount_div" class="o_row">
                            <field name="amount" string="Monto"/>
                            <field name="currency_id" options="{'no_create': True, 'no_open': True}" groups="base.group_multi_currency" string="Moneda"/>
                        </div>
                        <field name="amount_company_currency" string="Monto en moneda de la compañía"/>
                    </group>
                    <group>
                        <field name="state" string="Estado"/>
                        <field name="owner_name" attrs="{'invisible':[('type','!=','third_voucher')],'required':[('type','=','third_voucher')]}"/>
                        <field name="owner_vat" attrs="{'invisible':[('type','!=','third_voucher')],'required':[('type','=','third_voucher')]}"/>
                        <field name="issue_date" string="Fecha de Emisión"/>
                        <field name="payment_date" string="Fecha de Pago"/>
                        <field name="company_id" groups="base.group_multi_company" widget="selection" string="Compañía"/>
                    </group>
                </group>
                <group string="Operaciones">
                    <field name="operation_ids" nolabel="1" readonly="1">
                        <tree>
                            <field name="date" string="Fecha"/>
                            <field name="operation" string="Operación" />
                            <field name="origin" string="Origen"/>
                            <field name="partner_id" string="Contacto" />
                        </tree>
                        <form>
                            <group>
                                <field name="date" string="Fecha"/>
                                <field name="operation" string="Operación"/>
                                <field name="origin" string="Origen"/>
                                <field name="partner_id" string="Contacto"/>
                                <field name="notes" string="Notas"/>
                            </group>
                        </form>
                    </field>
                </group>
            </sheet>    
            <div class="oe_chatter">
                <field name="message_follower_ids" widget="mail_followers"/>
                <field name="activity_ids" widget="mail_activity"/>
                <field name="message_ids" widget="mail_thread"/>
            </div>                
            </form>
        </field>
    </record> 

    <record model="ir.ui.view" id="view_account_voucher_create_form">
        <field name="name">account.voucher.create.form</field>
        <field name="model">account.voucher</field>
        <field name="inherit_id" ref="view_account_voucher_form"/>
        <field name="groups_id" eval="[(4, ref('account.group_account_manager'))]"/>
        <field name="arch" type="xml">
                <form position="attributes">
                <attribute name="create">true</attribute>
            </form>
            <sheet position="before">
                <p class="alert alert-info" role="alert" style="margin-bottom:0px;" attrs="{'invisible':[('id','!=',False)]}">Recuerde que los vouchers se crean con los pagos.<br/><b>Solamente</b> debe crear vouchers manualmente para realizar algún <b>ajuste</b> o para la <b>carga incial</b> de los mismos.<br/>Podrá cargar las operaciones correspondientes una vez que haya guardado el voucher.</p>
                <p class="alert alert-info oe_edit_only" role="alert" style="margin-bottom:0px;" attrs="{'invisible':[('id','=', False)]}"><b>IMPORTANTE:</b> las operaciones de vouchers se crean automáticamente con los pagos, transferencias o los botones disponibles sobre el voucher.<br/><b>SOLO</b> debe crear o modificar operaciones para <b>carga de vouchers inciales</b> o ajustes sobre <b>circuitos no convencionales.</b></p>
            </sheet>
            <field name="operation_ids" position="attributes">
                <attribute name="readonly">0</attribute>
                <attribute name="attrs">{'readonly':[('id','=',False)]}</attribute>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="view_vouchers_search">
        <field name="name">voucher.search</field>
        <field name="model">account.voucher</field>
        <field name="arch" type="xml">
            <search string="Vouchers">
                <field name="name"/>
                <field name="first_partner_id"/>
                <field name="partner_id"/>
                <field name="journal_id"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="state"/>
                <field name="owner_name"/>
                <field name="owner_vat"/>
                <field name="payment_date"/>
                <filter name="to_cash" string="Ready to Cash" domain="[['state', '=', 'holding'], ['payment_date', '&lt;=', context_today().strftime('%Y-%m-%d')]]"/>
                <filter name="to_expire" string="Soon to Expire" domain="[['state', '=', 'holding'], ['payment_date', '&lt;=', (context_today()-datetime.timedelta(days=15)).strftime('%Y-%m-%d')]]"/>
                <group expand="0" string="Group By...">
                    <filter name="issue_date" string="Issue Date" context="{'group_by':'issue_date'}"/>
                    <filter name="payment_date" string="Payment Date" context="{'group_by':'payment_date'}"/>
                    <filter name="journal_id" string="Journal" context="{'group_by':'journal_id'}"/>
                    <filter name="state" string="State" context="{'group_by':'state'}"/>
                    <filter name="first_partner_id" string="First operation partner" context="{'group_by':'first_partner_id'}"/>
                    <filter name="last_partner_id" string="Last operation partner" context="{'group_by':'partner_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record model="ir.ui.view" id="view_account_voucher_calendar">
        <field name="name">account.voucher.calendar</field>
        <field name="model">account.voucher</field>
        <field name="arch" type="xml">
            <calendar string="Vouchers"
                    mode="month"
                    date_start="payment_date"
                    color="card_id">
                <field name="amount"/>
            </calendar>
        </field>
    </record>

    <!-- Third voucher Menu -->
    <record model="ir.actions.act_window" id="action_third_voucher">
        <field name="name">Third Vouchers</field>
        <field name="res_model">account.voucher</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="domain">[('type','=','third_voucher')]</field>
        <field name="context">{'search_default_state':'holding','default_type':'third_voucher'}</field>
    </record>

    <menuitem
        action="action_third_voucher"
        id="menu_third_voucher"
        sequence="40"
        parent="account_payment_fix.menu_finance_bank_and_cash"/>

    <!-- Issued voucher Menu -->
    <record model="ir.actions.act_window" id="action_issue_voucher">
        <field name="name">Issue Vouchers</field>
        <field name="res_model">account.voucher</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="domain">[('type','=','issue_voucher')]</field>
        <field name="context">{'search_default_state':'handed','default_type':'issue_voucher'}</field>
    </record>

    <menuitem
        action="action_issue_voucher"
        id="menu_issue_voucher"
        sequence="50"
        parent="account_payment_fix.menu_finance_bank_and_cash"/>

</odoo>
